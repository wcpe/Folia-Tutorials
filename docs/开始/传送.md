---
sidebar_position: 5
---

## 传送✨

传送/生成实体的操作必须在拥有实体的区域(线程)中的执行。根据位置获得对应线程会很麻烦， 我们可以使用`EntityScheduler`更方便的完成相关任务调度。
:::tip

当然别忘了： `Entity#teleport`在任何种类的传送都不能使用，使用`teleportAsync`!

:::


### 一般情况的传送

实体的Location已知，目的地也是确定的。 这种情况下的传送原理是先在当前世界移除实体，然后在目标位置生成实体。

在这个过程中服务端会使用RegionizedTaskQueue(Folia服务端的类)任务队列实现。

同时玩家重生与登录也属于这样的传送。


### 通过传送门的传送

不同于上面的传送，传送门的传送在初期无法确定目的地的准确位置，在一般情况下的传送中插入了一个异步搜索/创建出口的传送门的步骤。

:::tip 举例

比如地狱门已存在就要搜索地狱门，如没有地狱门就要生成一个地狱门。

:::


与原版不同的是，在Folia服务端中，非玩家实体通过传送门进入下界时，如果另一端的传送门未生成，则会在另一侧生成传送门。



### 在传送过程中服务器关闭

由于上述描述，传送的原理是分为多步进行的，如果服务器的关闭过程需要处理未完成的传送。