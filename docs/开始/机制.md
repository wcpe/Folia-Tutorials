---
sidebar_position: 2
---
区域之间的关系是并行，而不是并发。区域之间不共享数据 。 正如多线程之名，不是所有的数据都是线程安全的。 如果为了开发方便，实现数据共享可能会导致需要分配更多资源来维护线程上下文。 所以你需要使用例如`RegionScheduler`和`EntityScheduler`这样的API，来保证调度程序的代码在正确的线程上下文中运行。

>线程上下文检查是一种在多线程编程中使用的技术，用于确保代码在正确的线程上下文中执行，从而避免出现潜在的问题和错误。在多线程环境中，多个线程可以并行执行不同的任务，每个线程都有自己的上下文，包括线程本地变量、寄存器状态、堆栈等。如果代码在错误的线程上下文中执行，可能会导致数据竞争、死锁、内存错误等问题。上下文是指程序执行的环境和状态，包括当前的变量值、函数调用栈、寄存器状态等。线程上下文检查通常用于确保代码只在特定的线程上下文中运行，以保证数据的一致性和正确性。

---

一般来说，如果玩家触发了一个事件，例如例如玩家破坏方块，你可以在这个事件里访问该方块周围8个区块(一圈)的数据。但也不保证它是完全安全的，插件的代码中应该使用新增的线程检查API做出判断... `Bukkit.isownedbycurrentreregion`

如何做到线程安全地访问数据？对区域来说，它包含的区块内所有实体、方块和兴趣点（POI）(应该是特定地标结构？)的访问是安全的。

这里指的数据是区域内的实体、方块、POI， 与插件中包含的数据无关。对于插件的存储、访问数据、事件和命令，你可以照常访问。但你仍然要保证访问的数据也是线程安全的，你需要考虑多个区域同时访问、修改数据的情况。 关于事件、命令的调用，区域在线程池中并行地更新，所以命令和事件的调用也是并行的。基本很难做到同步：死锁:敢不敢跟我比划比划？

>同步（Synchronization）： 同步是指在多线程环境下，控制多个线程的执行顺序和访问共享资源的方式，以确保数据的正确性和一致性。通过同步机制，可以确保在某个线程访问共享资源时，其他线程必须等待，直到资源被释放或操作完成。同步可以通过锁（Lock）、互斥量（Mutex）、信号量（Semaphore）等机制来实现。同步的目的是防止多个线程同时访问共享资源导致的数据竞争和不确定性问题，确保在某一时刻只  有一个线程能够操作共享资源，从而保证数据的正确性。
>
>并行（Parallelism）： 并行是指在同一时刻，多个任务或线程在多个处理器核心上同时执行，以提高整体的执行效率和速度。并行可以实现更高地计算性能，特别是对于需要大量计算或处理的任务。并行的目的是提高程序的运行效率，通过将多个任务分配给不同的处理器核心来同时执行，从而缩短任务的完成时间。
>
>同步关注的是线程之间对共享资源的访问顺序和安全性，以避免数据竞争和不一致性问题。
>
>并行关注的是同时执行多个任务或线程，以提高整体的计算性能和效率。

---
一般情况下，数据使用并发集合，例如`ConcurrentHashMap` 、`CopyOnWriteArrayList`储存就可以解决了。 

但你仍须留意你的代码中不会出现隐藏的线程安全问题。 也许这个问题只是会偶然导致数据丢失。 但这个时候服主不会清楚是什么导致的问题，并且这种隐藏的多线程问题对于复现与溯源是十分困难的。